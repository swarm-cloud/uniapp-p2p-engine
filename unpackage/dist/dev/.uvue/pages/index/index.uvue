
	
	import { ConfigOptions,initP2p,getP2pUrl,getP2pEngineVersion,p2pIsConnected,stopP2p } from "@/uni_modules/cdnbye-swarmcloud";
	export default {
		onReady() {
			//注意uniappx 的video组建ios没有实现 请自行更换其他播放器
		      this.videoContext = uni.createVideoContext('video', this);
		    },
		data() {
			return {
				videoContext: null as VideoContext | null,
				header: {
				          'User-Agent': 'User-Agent test',
				          'header': 'header test',
				          'cookie': 'cookie test'
				        } as UTSJSONObject,
				// 属性
				src:"",
				oldsrc: "https://s5.bfengbf.com/video/17haoyinlecangkudierji/20240216/index.m3u8",
				
			}
		},
		onLoad() {

		},
		onShow() {
			
		},
		methods: {
			initCdnbye: function () {
				
				let options = {
				   logEnabled: true,
				   logLevel: 1,
				   trackerZone:0
				 } as ConfigOptions;
				 initP2p("4-iRPC_GR",options);
				 console.log(getP2pEngineVersion(), " at pages/index/index.uvue:52");
				 
			},
			
			startPlay(){
				this.src=getP2pUrl(this.oldsrc);
				console.log(this.src, " at pages/index/index.uvue:58");
				
				this.videoContext?.play();
				
				
				
				
			},
			isConnected(){
				//开始播放了才为true
				console.log(p2pIsConnected(), " at pages/index/index.uvue:68");
			},
			stopP2p(){
				stopP2p();
			},
			stop(){
				this.videoContext?.stop();
			},
			
			onError: function (res : UniVideoErrorEvent) {
			        console.log(res.type + " -> " + JSON.stringify(res.detail), " at pages/index/index.uvue:78");
			       
			},

		}
	}


function GenPagesIndexIndexRender(): any | null {
const _ctx = this
const _cache = this.$.renderCache
  return createElementVNode("view", utsMapOf({ class: "content" }), [
    createElementVNode("video", utsMapOf({
      class: "video",
      ref: "video",
      id: "video",
      header: _ctx.header,
      src: _ctx.src,
      onError: _ctx.onError,
      controls: true
    }), null, 40 /* PROPS, NEED_HYDRATION */, ["header", "src", "onError"]),
    createElementVNode("button", utsMapOf({
      type: "primary",
      onClick: _ctx.initCdnbye
    }), "初始化cdnbye", 8 /* PROPS */, ["onClick"]),
    createElementVNode("button", utsMapOf({ onClick: _ctx.startPlay }), "p2p播放", 8 /* PROPS */, ["onClick"]),
    createElementVNode("button", utsMapOf({ onClick: _ctx.stop }), "停止播放", 8 /* PROPS */, ["onClick"]),
    createElementVNode("button", utsMapOf({ onClick: _ctx.stopP2p }), "停止P2P", 8 /* PROPS */, ["onClick"]),
    createElementVNode("button", utsMapOf({ onClick: _ctx.isConnected }), "是否CDNBye连接", 8 /* PROPS */, ["onClick"])
  ])
}
const GenPagesIndexIndexStyles = [utsMapOf([["content", padStyleMapOf(utsMapOf([["display", "flex"], ["alignItems", "center"], ["justifyContent", "center"]]))], ["logo", padStyleMapOf(utsMapOf([["height", "200rpx"], ["width", "200rpx"], ["marginTop", "200rpx"], ["marginBottom", "50rpx"]]))], ["title", padStyleMapOf(utsMapOf([["fontSize", "36rpx"], ["color", "#8f8f94"]]))]])]
